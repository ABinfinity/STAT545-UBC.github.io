<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Bernhard Konrad" />

<meta name="date" content="2014-11-10" />

<title>Write your own R package</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="libs/bootstrap-2.3.2/css/united.min.css" rel="stylesheet" />
<link href="libs/bootstrap-2.3.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
<script src="libs/bootstrap-2.3.2/js/bootstrap.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/default.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>


<link rel="stylesheet" href="libs/local/nav.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
</style>
<div class="container-fluid main-container">

<header>
  <div class="nav">
    <a class="nav-logo" href="index.html">
      <img src="static/img/stat545-logo-s.png" width="70px" height="70px"/>
    </a>
    <ul>
      <li class="home"><a href="index.html">Home</a></li>
      <li class="faq"><a href="faq.html">FAQ</a></li>
      <li class="syllabus"><a href="syllabus.html">Syllabus</a></li>
      <li class="topics"><a href="topics.html">Topics</a></li>
      <li class="people"><a href="people.html">People</a></li>
    </ul>
  </div>
</header>

<div id="header">
<h1 class="title">Write your own R package</h1>
<h4 class="author"><em>Bernhard Konrad</em></h4>
<h4 class="date"><em>2014-11-10</em></h4>
</div>


<div id="your-mission" class="section level3">
<h3>Your mission</h3>
<p>This is a step-by-step instruction on how to create your first R package. <em>This will be much easier than you think.</em></p>
<p>In this tutorial we will develop a package <em>gameday</em> that provides the function <code>gday()</code>. This function takes one argument <code>team.name</code>, the name of your favorite <a href="http://www.nhl.com/">NHL</a> team, and returns <code>TRUE</code> if this team has a game today, and <code>FALSE</code> otherwise. The function will actually be a one-liner because we can read this information from the web.</p>
</div>
<div id="prerequisites" class="section level3">
<h3>Prerequisites</h3>
<p>We assume you have <a href="packages01_system-prep.html">configured your system for R package development</a>. This will ensure you have all the right software installed and that it’s updated. Please be adviced that ignoring this prep will only lead to heartache.</p>
</div>
<div id="setting-up-the-directory-rstudio-project-r-package-git-repo" class="section level3">
<h3>Setting up the directory = RStudio project = R package = Git repo</h3>
<p>R expects a certain folder structure for your package. Luckily, the package <code>devtools</code> does this work for us.</p>
<pre><code>library(&quot;devtools&quot;)
create(&quot;/home/bernhard/Desktop/gameday&quot;)</code></pre>
<p><strong>!! Replace this path above with a path that exists on your computer !!</strong></p>
<p>This creates a folder <em>gameday</em> on my Desktop, and populates it with a couple of files. Navigate to this folder and open <code>gameday.Rproj</code> with <em>RStudio</em>.</p>
<p>Before we talk about the files and folders that were created, let’s put this under version control: <em>Tools &gt; Version Control &gt; Project Setup</em>. Then choose <em>Version control system: Git</em> and <em>initialize a new git repository for this project</em>. Then restart RStudio in this Project.</p>
<p>Now, let’s talk about the contents of our <em>gameday</em> directory.</p>
</div>
<div id="files-that-make-a-packages" class="section level3">
<h3>Files that make a packages</h3>
<p><span class="citation">@jennybc</span>: the header of this section contains a typo but I’m not sure of your intent</p>
<ul>
<li>Helper files that we don’t have to worry about now:
<ul>
<li><code>.gitignore</code> The usual ignore file for Git. We don’t have to change it.</li>
<li><code>.Rbuildignore</code> An ignore file for the R package building process. We can talk about this later.</li>
<li><code>.Rhistory</code> The usual history file of your R session. We don’t have to change it.</li>
<li><code>gameday.Rproj</code> The usual file for an RStudio project. We don’t have to change it.</li>
<li><code>NAMESPACE</code> A very important file, but we will never edit this by hand. <code>roxygen2</code> will maintain this for us.</li>
</ul></li>
<li><code>R/</code> finally, this is where the actual R code will go.</li>
<li><code>DESCRIPTION</code> holds meta information about your package. We will modify this first. (Technically, the presence of this very file signals to RStudio that the <code>gameday</code> Project is a package.)</li>
</ul>
</div>
<div id="the-description-file" class="section level3">
<h3>The DESCRIPTION File</h3>
<p>Here is where we add information about the package (gameday) and its authors (us). Some fields are pre-filled, but many more fields can be added as necessary. The initial raw version may depend on your version of <code>devtools</code> but should look similar to this:</p>
<pre><code>Package: gameday
Title: What the package does (one line)
Version: 0.1
Authors@R: &quot;First last &lt;first.last@example.com&gt; [aut, cre]&quot;
Description: What the package does (one paragraph)
Depends: R (&gt;= 3.1.2)
License: What license is it under?
LazyData: true</code></pre>
<p>Let’s look at those in detail. <strong>Bold</strong> fields are mandatory:</p>
<ul>
<li><strong>Package</strong>. The name of the package. We will leave this as <em>gameday</em>.</li>
<li><strong>Title</strong>. A one-line description of what the package does. Capitalize principal words, stick to a single line, don’t use markup and do not end in a period.</li>
<li><strong>Version</strong>. Convention has it that this should be in the format <code>&lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</code>. Since we are only in development we start a fourth digit, which, also by convention, starts with <code>9000</code>. Hence <code>0.0.0.9000</code> is a good starting point, and <code>0.0.0.9001</code> would be the next (development) version while <code>0.1.0</code> or <code>1.0.0</code> would be the first release version.</li>
<li><strong>Authors@R</strong>. Machine-readable description of the authors (<code>aut</code>), maintainer (<code>cre</code>), contributors (<code>ctb</code>) and others (see <code>?person</code>).</li>
<li><strong>Description</strong>. One paragraph of what the packages does. Lines of 80 characters or less. Indent subsequent lines with 4 spaces.</li>
<li><strong>License</strong>. Who can use this package and for what? I suggest <a href="http://creativecommons.org/publicdomain/zero/1.0/"><em>CC0</em></a>, which means that we dedicate our package to the public domain and waive all of our rights. Anyone can freely use/adapt/modify/sell this work without our permission. We also don’t provide any warranties about liability or correctness. You can check our <a href="http://creativecommons.org/choose/">other creative common licenses</a>.</li>
<li><em>LazyData</em>. Is a little technical, but setting this to <code>true</code> makes your package a better citizen with respect to memory.</li>
<li>There are <a href="http://cran.r-project.org/doc/manuals/r-release/R-exts.html#The-DESCRIPTION-file">many more fields available</a>.</li>
</ul>
<p>Hence, a reasonable version of <code>DESCRIPTION</code> after editing would be</p>
<pre><code>Package: gameday
Title: Let R tell you if your NHL team plays today
Version: 0.0.0.9000
Authors@R: as.person(c(
    &quot;Bernhard Konrad &lt;bernhard.konrad@gmail.com&gt; [aut, cre]&quot;, 
    &quot;Jennifer Bryan &lt;jenny@stat.ubc.ca&gt; [aut]&quot;
    ))
Description: Query live.nhle.com to check if your NHL team is listed on
    the teams that play today
Depends: R (&gt;= 3.1.2)
License: CC0
LazyData: true</code></pre>
</div>
<div id="the-actual-r-code" class="section level3">
<h3>The actual R code</h3>
<p>The R code that our package provides is in the <em>R</em> folder. So let’s <strong>create a new R script</strong> and save it in the <em>R</em> folder with the name <code>gday.R</code>.</p>
<p>The content is the following:</p>
<pre><code>gday &lt;- function(team.name=&quot;canucks&quot;) {
  url &lt;- paste0(&quot;http://live.nhle.com/GameData/GCScoreboard/&quot;, Sys.Date(), &quot;.jsonp&quot;)
  grepl(team.name, getURL(url), ignore.case=TRUE)
}</code></pre>
<p>We first construct the url where the data for today’s matches is stored, and then <code>grepl</code> to check if <code>team.name</code> is among them. <a href="http://live.nhle.com/GameData/GCScoreboard/2014-11-09.jsonp">See how the data file looks like</a> and compare with <a href="http://www.nhl.com/">today’s matches on NHL.com</a>. Notice that we use <code>RCurl::getURL</code>, which we have to add to our list of <em>dependencies</em> in <code>DESCRIPTION</code>, i.e.</p>
<pre><code>Depends: R (&gt;= 3.1.2)</code></pre>
<p>becomes</p>
<pre><code>Depends:
    R (&gt;= 3.1.2),
    RCurl</code></pre>
<p>So far so good. But what about <a href="http://asset-1.soup.io/asset/1524/9224_10db.jpeg">documentation</a> (what you would see with <code>?gday</code>)? Luckily, <code>roxygen2</code> helps us with that and allows us to add the documentation as comments directly in the <em>R</em> script. All we have to do is start the line with <code>#'</code> and use the <code>\@</code> notation like so:</p>
<pre><code>#&#39; Is it Gameday?
#&#39;
#&#39; This function returns TRUE if your NHL team plays today
#&#39; and FALSE otherwise
#&#39; 
#&#39; You know then problem: You&#39;re in your office writing R code and
#&#39; suddenly have the urge to check whether your NHL team has a game today.
#&#39; Before you know it you just wasted 15 minutes browsing the lastest
#&#39; news on your favorite hockey webpage.
#&#39; Suffer no more! You can now ask R directly, without tempting yourself
#&#39; by firing up your web browser.
#&#39; 
#&#39; @param team.name Defaults to &quot;canucks&quot;
#&#39; @return \code{TRUE} if \code{team.name} has an NHL game on \code{date},
#&#39; \code{FALSE} otherwise
#&#39; @keywords misc
#&#39; @note case in \code{team.name} is ignored
#&#39; @export
#&#39; @examples
#&#39; gday()
#&#39; gday(&quot;canadiens&quot;)
#&#39; gday(&quot;Bruins&quot;)</code></pre>
<p>A few of those tags need explanation</p>
<ul>
<li><code>\@keywords</code> must be taken from the <a href="https://svn.r-project.org/R/trunk/doc/KEYWORDS">list of R keywords</a></li>
<li><code>\@export</code> makes the function <code>gday</code> available when the package is loaded, in contrast to a helper function that is only designed for internal use within the package.</li>
<li>There are <a href="http://r-pkgs.had.co.nz/man.html">many more tags and explanations</a> if you want to learn more.</li>
</ul>
</div>
<div id="documentation-for-the-package-itself" class="section level3">
<h3>Documentation for the package itself</h3>
<p>We now have a documentation for the <code>gday</code> function. Next, let’s add a minimal documentation of the <code>gameday</code> package itself (what you would see with <code>?gameday</code>). For that, open a <em>New R script</em> and save it as <em>R/gameday.r</em>. The content should be something like</p>
<pre><code>#&#39; My first R package: gameday
#&#39; 
#&#39; This is so much fun
#&#39; 
#&#39; I look forward to writing really neat packages
#&#39; so that I can have all my helper functions in one place
#&#39; and maybe even share them.
#&#39; 
#&#39; @docType package
#&#39; @name gameday
NULL</code></pre>
<ul>
<li>We don’t have any <em>R</em> code to document here, hence we put <code>NULL</code>.</li>
<li><code>\@docType package</code> specifies that we document the package itself</li>
</ul>
</div>
<div id="let-devtools-roxygen2-compile-the-documenation-for-you" class="section level3">
<h3>Let devtools, roxygen2 compile the documenation for you</h3>
<p>Phew, that was a lot of work, but now we can hand the rest over back to <em>R</em>. In particular, <code>devtools</code> and <code>roxygen2</code> will compile the documentation</p>
<pre><code>library(&quot;devtools&quot;)
document()</code></pre>
<p>When we run this the first time, the new folder <code>man</code> is created with the files <code>gameday.Rd</code> and <code>gday.Rd</code>. Go ahead an open those, this is what we would have had to write if it was not for <code>roxygen2</code> (the syntax resembles the markup language <a href="http://en.wikipedia.org/wiki/LaTeX">LaTeX</a>).</p>
<p>Also observe that we now have a file <code>NAMESPACE</code> which, as expected, says that the package <code>gameday</code> provides the function <code>gday</code>.</p>
</div>
<div id="build-the-package" class="section level3">
<h3>Build the package</h3>
<p>As a final step, let’s build the package. In <em>RStudio</em> use the <em>Build</em> tab and choose <em>Build &amp; Reload</em>. That’s it. Your package is now checked, installed and loaded. Your <em>R</em> session is also restarted. You are now able to run</p>
<pre><code>gday(&quot;canucks&quot;)
gday(&quot;flames&quot;)</code></pre>
<p>and will notice that (on 2014-11-10) the Vancouver Canucks are not playing, but the Calgary Flames do have a game. To see the rendered version of our documentation, use</p>
<pre><code>?gameday
?gday</code></pre>
<p>As you update the package, frequently run <code>document()</code> and then <em>Build &amp; Reload</em> to test your latest version.</p>
</div>
<div id="publish-on-github" class="section level3">
<h3>Publish on GitHub</h3>
<div id="commit-locally" class="section level4">
<h4>Commit locally</h4>
<p>First we have to commit all our files. In <em>RStudio</em>, go to the <em>Git</em> tab, check all files and folders, click <em>commit</em>, add a <em>commit message</em> (eg “my first version of my first R package”) and <em>commit</em>.</p>
</div>
<div id="create-new-empty-github-repository" class="section level4">
<h4>Create new, empty GitHub repository</h4>
<p>As a final step we will now make our package available on GitHub. If we want others to see and use our work we have to make this repository public.</p>
<ol style="list-style-type: decimal">
<li>Go to <code>github.com</code> and click on your username (should be on the top right).</li>
<li>Choose <em>Repositories -&gt; New</em></li>
<li>The repository name is <em>gameday</em>. You can leave <em>Description</em> empty. Choose <strong>Public</strong> and <strong>do NOT initialize with a README</strong>.</li>
<li>Copy the address of the repository. For me this is <code>https://github.com/BernhardKonrad/gameday</code>.</li>
</ol>
</div>
<div id="connect-rstudio-and-github" class="section level4">
<h4>Connect RStudio and GitHub</h4>
<p>We have to tell <em>RStudio</em> where to put the files of our new package. For this, we have to briefly default back to the <em>Shell</em>:</p>
<ol style="list-style-type: decimal">
<li><em>Tools -&gt; Shell…</em>.</li>
<li>In the shell we have to add the GitHub repository as a remote, and we abbreviate it as <em>origin</em>: <code>git remote add origin https://github.com/BernhardKonrad/gameday</code>.</li>
<li>Push your changes to the new remote (branch <em>master</em>), and set this remote as the new default: <code>git push -u origin master</code>.</li>
<li>Close the shell, you will now be able to push and pull directly from <em>RStudio</em>.</li>
<li>Your package is now publically (and freely, remember the License) available to the world.</li>
<li><p>It gets better: You can actually install your package from GitHub directly:</p>
<pre><code>install_github(&quot;BernhardKonrad/gameday&quot;)</code></pre></li>
</ol>
<p>The End (for now)</p>
<hr />
</div>
</div>

<div class="footer">
This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/3.0/">CC BY-NC 3.0 Creative Commons License</a>.
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
