<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Bernhard Konrad" />

<meta name="date" content="2014-11-10" />

<title>Write your own R package</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="libs/bootstrap-2.3.2/css/united.min.css" rel="stylesheet" />
<link href="libs/bootstrap-2.3.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
<script src="libs/bootstrap-2.3.2/js/bootstrap.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/default.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>


<link rel="stylesheet" href="libs/local/nav.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
</style>
<div class="container-fluid main-container">

<header>
  <div class="nav">
    <a class="nav-logo" href="index.html">
      <img src="static/img/stat545-logo-s.png" width="70px" height="70px"/>
    </a>
    <ul>
      <li class="home"><a href="index.html">Home</a></li>
      <li class="faq"><a href="faq.html">FAQ</a></li>
      <li class="syllabus"><a href="syllabus.html">Syllabus</a></li>
      <li class="topics"><a href="topics.html">Topics</a></li>
      <li class="people"><a href="people.html">People</a></li>
    </ul>
  </div>
</header>

<div id="header">
<h1 class="title">Write your own R package</h1>
<h4 class="author"><em>Bernhard Konrad</em></h4>
<h4 class="date"><em>2014-11-10</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#write-your-own-r-package">Write your own R package</a></li>
<li><a href="#getting-started">Getting Started</a></li>
</ul>
</div>

<div id="write-your-own-r-package" class="section level1">
<h1>Write your own R package</h1>
<p>This is a step-by-step instruction on how to create your first R package.</p>
<ul>
<li>This will be much easier than you think</li>
<li>Bundle helper functions for your other projects</li>
<li>Share your code</li>
<li>Add (some) documentation and examples</li>
<li>Add tests</li>
</ul>
</div>
<div id="getting-started" class="section level1">
<h1>Getting Started</h1>
<p>In this tutorial we will develop a package that provides the function <code>gameday</code>. This function takes one argument <code>teamname</code>, the name of your favorite <a href="http://www.nhl.com/">NHL</a> team, and returns <code>TRUE</code> if this team has a game today, and <code>FALSE</code> otherwise. The function will actually be a one-liner because we can read this information from the web.</p>
<div id="packages-that-you-will-need" class="section level3">
<h3>Packages that you will need</h3>
<p>Please make sure to run <code>install.packages('devtools')</code> and <code>install.packages('roxygen2')</code>.</p>
<p><span class="citation">@jennybc</span>: Let’s say we assume everyone is running very current R (3.1.0 or higher?) and RStudio. I also recommend that everyone start with <code>update.packages()</code>. Specifically, devtools, roxygen2, testthat, and knitr should all be very current, so why not just update everything?</p>
</div>
<div id="some-background-and-pointers" class="section level3">
<h3>Some Background and pointers</h3>
<p>You can skip this section on your first read if you want to dive right into the hands-on exercise.</p>
<p><span class="citation">@jennybc</span>: TODO for me. Might link to slides.</p>
</div>
<div id="setting-up-the-folder-structure" class="section level3">
<h3>Setting up the folder structure</h3>
<ul>
<li>R expects a certain folder structure for your package. Luckily, <code>RStudio</code>, using <code>devtools</code>, does this work for you.</li>
<li>In <em>RStudio</em>: <em>File -&gt; New Project -&gt; New Directory -&gt; R Package</em>.</li>
<li>Package name <code>gameday</code> and please also make sure that <strong>Create a git repository</strong> is checked.</li>
</ul>
<p>You see that this created a galore of files and folders. Let’s see what they are.</p>
<p><span class="citation">@jennybc</span>: No, sadly, RStudio does not (yet) use devtools for this, though apparently it soon will. In the meantime, let’s follow the advice given in Hadley’s book, which is to use <code>devtools::create(&quot;path/to/package/pkgname&quot;)</code>, followed by double clicking on the associated <code>pkgname.Rproj</code> file or RStudio File &gt; New Project &gt; Existing Directory … pointed at <code>path/to/package/pkgname</code> and with <strong>Create a git repository</strong> checked. Here’s a side-by-side comparison of freshly created R packages via the two different workflows (I think I forgot to make it a Git repo via RStudio, but that’s neither here nor there):</p>
<p><img src="img/rstudio-vs-devtools-create-for-new-pkg.png" /></p>
</div>
<div id="files-that-make-a-packages" class="section level3">
<h3>Files that make a packages</h3>
<ul>
<li>Helper files that we don’t have to worry about:
<ul>
<li><code>.gitignore</code> is the usual ignore file for Git. We don’t have to change it.</li>
<li><code>.Rbuildignore</code> is an ignore file for the R package building process. We can talk about this later.</li>
<li><code>gameday.Rproj</code> is the usual file for an RStudio project. We don’t have to change it.</li>
<li><code>NAMESPACE</code> is a very important file, but we will never edit this by hand. <code>roxygen2</code> will maintain this for us.</li>
</ul></li>
<li><code>R/</code> finally, this is where the actual R code will go.</li>
<li><code>DESCRIPTION</code> holds meta information about your package. We will modify this first.</li>
</ul>
<p><span class="citation">@jennybc</span>: If you submit to my plea that we init package with <code>devtools::create()</code> two bullet points go away. I have deleted them for you!</p>
</div>
<div id="description-file" class="section level3">
<h3>DESCRIPTION FILE</h3>
<p>Here is where we add information about the package (gameday) and its authors (us). Some fields are pre-filled, but many more fields can be added as necessary.</p>
<p><span class="citation">@jennybc</span>: Maybe you should mention that this is how it looks <em>after</em> editing? Why do you have <code>Type: Package</code>? Start with version 0.1 or, as <a href="http://r-pkgs.had.co.nz/description.html#version">Hadley’s book recommends</a>, 0.0.0.9000. Omit the date. Use the new syntax for authors, contributors, etc. Pick single author (you) or maintainer + contributor (you + me) as you see fit. Single author might be more relevant to them today. Hard line breaks and indents in the description. Make it depend on R now or future for safety. Put LazyData true. I’ve just put in what I think this should be.</p>
<pre><code>Package: gameday
Title: Let R tell you if your NHL team plays today
Version: 0.0.0.9000
Authors@R: person(&quot;Bernhard&quot;, &quot;Konrad&quot;, email = &quot;bernhard.konrad@gmail.com&quot;,
    role = c(&quot;aut&quot;, &quot;cre&quot;))
Authors@R: as.person(c(
    &quot;Bernhard Konrad &lt;bernhard.konrad@gmail.com&gt; [aut, cre]&quot;, 
    &quot;Jennifer Bryan &lt;jenny@stat.ubc.ca&gt; [aut]&quot;
    ))
Description: Query live.nhle.com to check if your NHL team is listed on
    the teams that play today
Depends: R (&gt;= 3.1.1)
License: CC0
LazyData: true</code></pre>
<p>Let’s briefly discuss some of those fields.</p>
<ul>
<li>You must specify a <code>Maintainer</code> or __cre_ator and must provide a contact email.</li>
<li><code>License</code> <a href="http://creativecommons.org/publicdomain/zero/1.0/"><em>CC0</em></a> means that we dedicate our package to the public domain and waive all of our rights. Anyone can freely use/adapt/modify/sell this work without our permission. We also don’t provide any warranties about liability or correctness. You can check our <a href="http://creativecommons.org/choose/">other creative common licenses</a>.</li>
</ul>
</div>
<div id="the-actual-r-code" class="section level3">
<h3>The actual R code</h3>
<p>The R code that our package provides is in the <em>R</em> folder. You see that a file <code>gameday.R</code> is already there. We will leave this alone for now. Instead, let’s <strong>create a new R script</strong> and save it in the <em>R</em> folder with the name <code>gday.R</code>.</p>
<p>The content is the following:</p>
<pre><code>#&#39; Is it Gameday?
#&#39;
#&#39; This function returns TRUE if your NHL team plays today
#&#39; @param teamname Defaults to &quot;canucks&quot;
#&#39; @param date The (potential game) day you want to check
#&#39; @return \code{TRUE} if \code{teamname} has an NHL game on \code{date},
#&#39; \code{FALSE} otherwise
#&#39; @keywords misc
#&#39; @note case in \code{teamname} is ignored
#&#39; @export
#&#39; @examples
#&#39; gday()
#&#39; gday(&quot;canadiens&quot;)
#&#39; gday(&quot;Bruins&quot;, &quot;2014-11-07&quot;)

gday &lt;- function(teamname=&quot;canucks&quot;) {
  url &lt;- paste0(&quot;http://live.nhle.com/GameData/GCScoreboard/&quot;, Sys.Date(), &quot;.jsonp&quot;)
  grepl(teamname, getURL(url), ignore.case=TRUE)
}</code></pre>
<p>TODO: explain function gday. Explain roxygen syntax (split the above up in two steps). Add dependency <code>RCurl</code> to DESCRIPTION.</p>
</div>
<div id="documentation-for-the-package-itself" class="section level3">
<h3>Documentation for the package itself</h3>
<pre><code>#&#39; More documentation
#&#39; 
#&#39; and some more stuff
#&#39; 
#&#39; and even more details
#&#39; that spans two lines
#&#39; 
#&#39; @docType package
#&#39; @name gameday
NULL</code></pre>
<p>TODO: explain roxygen syntax and why <code>NULL</code></p>
</div>
<div id="let-devtools-roxygen2-do-the-documenation-for-you" class="section level3">
<h3>Let devtools, roxygen2 do the documenation for you</h3>
<p>Run <code>document()</code> and <em>Build &amp; Reload</em> for testing.</p>
</div>
<div id="publish-on-github" class="section level3">
<h3>Publish on GitHub</h3>
<ol style="list-style-type: decimal">
<li>commit files locally</li>
<li>Create empty repo on github</li>
<li>Add remote: Shell -&gt; Terminal -&gt; git remote add … -&gt; git push -u origin master</li>
<li>install from github</li>
</ol>
<hr />
</div>
</div>

<div class="footer">
This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/3.0/">CC BY-NC 3.0 Creative Commons License</a>.
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
