<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Bernhard Konrad" />


<title>Write your own R package, part 2</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="libs/bootstrap-2.3.2/css/united.min.css" rel="stylesheet" />
<link href="libs/bootstrap-2.3.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
<script src="libs/bootstrap-2.3.2/js/bootstrap.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/default.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>


<link rel="stylesheet" href="libs/local/nav.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
</style>
<div class="container-fluid main-container">

<header>
  <div class="nav">
    <a class="nav-logo" href="index.html">
      <img src="static/img/stat545-logo-s.png" width="70px" height="70px"/>
    </a>
    <ul>
      <li class="home"><a href="index.html">Home</a></li>
      <li class="faq"><a href="faq.html">FAQ</a></li>
      <li class="syllabus"><a href="syllabus.html">Syllabus</a></li>
      <li class="topics"><a href="topics.html">Topics</a></li>
      <li class="people"><a href="people.html">People</a></li>
    </ul>
  </div>
</header>

<div id="header">
<h1 class="title">Write your own R package, part 2</h1>
<h4 class="author"><em>Bernhard Konrad</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#write-your-own-r-package-part-2">Write your own R package, part 2</a><ul>
<li><a href="#documentation-for-the-package-itself">Documentation for the package itself</a></li>
<li><a href="#vignette">Vignette</a></li>
<li><a href="#publish-on-github">Publish on GitHub</a></li>
<li><a href="#tests">Tests</a></li>
<li><a href="#update-the-r-code">Update the R code</a></li>
<li><a href="#let-devtools-roxygen2-compile-the-documenation-for-you">Let devtools, roxygen2 compile the documenation for you</a></li>
</ul></li>
</ul>
</div>

<div id="write-your-own-r-package-part-2" class="section level1">
<h1>Write your own R package, part 2</h1>
<p>Where we left off on Monday:</p>
<ul>
<li>Created <code>gameday</code> package layout with <code>devtools::create()</code></li>
<li>Modified <code>DESCRIPTION</code></li>
<li>Added <code>gday.R</code> function to the <code>gameday</code> package. It checks if your NHL team plays today</li>
<li>Added <code>roxygen2</code>-style documentation to <code>gday()</code></li>
<li>Built package in <em>RStudio</em> with <em>Build &amp; Reload</em> from the <em>Build</em> tab</li>
<li>What works now:
<ul>
<li><code>library(&quot;gameday&quot;)</code> loads our package</li>
<li><code>gday(&quot;canucks&quot;)</code> tells us if the <em>Vancouver Canucks</em> have a game today</li>
<li><code>?gday</code> displays the help file we wrote</li>
</ul></li>
</ul>
<p>What we do next:</p>
<ul>
<li>Create help file for the <code>gameday</code> package, which is displayed by <code>?gameday</code>.</li>
<li>Add a vignette.</li>
<li>Publish <code>gameday</code> on GitHub.</li>
<li>Add tests with <code>testthat</code>.</li>
<li>Show interactive <em>fix &amp; test</em> workflow when we modify <code>gday()</code> and tests.</li>
</ul>
<p>================================================================================</p>
<div id="documentation-for-the-package-itself" class="section level3">
<h3>Documentation for the package itself</h3>
<p>We now have a documentation for the <code>gday</code> function. Next, let’s add a minimal documentation of the <code>gameday</code> package itself (what you would see with <code>?gameday</code>). For that, open a <em>New R script</em> and save it as <em>R/gameday.r</em>. The content should be something like</p>
<pre><code>#&#39; My first R package: gameday
#&#39; 
#&#39; A one-line sentence on what this packages does
#&#39; 
#&#39; Single paragraph with more detail on the package.
#&#39; This can span several lines.
#&#39; 
#&#39; @docType package
#&#39; @name gameday
NULL</code></pre>
<ul>
<li><code>\@docType package</code> specifies that we document the package itself (instead of a function)</li>
<li>We don’t have any <em>R</em> code to document here, but <code>roxygen2</code> needs some <em>R</em> code here. Hence the convention is to put the dummy code <code>NULL</code>.</li>
</ul>
</div>
<div id="vignette" class="section level3">
<h3>Vignette</h3>
<p>Vignettes allow you to give a broader overview of your package, and show new users what it can be used for and how to use it. Vignettes tell the story of your package. The good news is that, as of <em>R 3.0.0</em> you can use <em>Rmarkdown</em> to write your vignettes (previous <em>LaTeX</em> was required). It gets better: <code>devtools</code> provides a template for your vignette, to make the process of writing this user-friendly guide as easy as possible:</p>
<ul>
<li><p>In your package, call <code>library(devtools)</code> and then <code>use_vignette(&quot;overview&quot;)</code>. This creates <code>vignettes/overview.Rmd</code> and adds</p>
<pre><code>Suggests: knitr
VignetteBuilder: knitr</code></pre>
to your <code>DESCRIPTION</code> file.</li>
<li><p>Open <code>vignettes/overview.Rmd</code> and check the YAML:</p>
<pre><code>---
title: &quot;Vignette Title&quot;
author: &quot;Vignette Author&quot;
date: &quot;`r Sys.Date()`&quot;
output: rmarkdown::html_vignette
vignette: &gt;
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---</code></pre>
<ul>
<li>Please change the <em>title</em> and <em>author</em>, as well as the <em>Vignette Title</em>. Don’t be confused about <em>vignette: &gt;</em>, this just means that the following LaTeX lines are read as-is instead of being interpreted as YAML. After your changes, <code>vignettes/overview.Rmd</code> YAML should look similar to this:</li>
</ul></li>
<li>Now we can add the actual <em>Rmarkdown</em> of our vignette. We refer to other sources (TODO, <span class="citation">@jennybc</span>?) on what makes a good vignette.</li>
<li>Once you have your vignette in an acceptable state it is time to turn the <em>Rmarkdown</em> source into the vignette as the R package expects it. Since vignettes may take a long time to complile, this is <strong>not</strong> automatically done by <em>Build &amp; Reload</em>. Instead, use <code>devtools:build_vignettes()</code>. This puts all required files in the folder <code>inst/doc</code>.</li>
<li><p>You can now <em>Build &amp; Reload</em> your package, it will also make the vignette available. To view it, simply use <code>browseVignettes(package=&quot;gameday&quot;)</code>.</p></li>
</ul>
<p><a href="http://r-pkgs.had.co.nz/vignettes.html">More details</a></p>
</div>
<div id="publish-on-github" class="section level3">
<h3>Publish on GitHub</h3>
<div id="commit-locally" class="section level4">
<h4>Commit locally</h4>
<p>First we have to commit all our files to our local git repository. If you don’t have a <em>Git</em> tab in <em>RStudio</em>, go to <em>Tools -&gt; Version Control -&gt; Project Setup</em> and choose <em>Git</em>. This will restart <em>RStudio</em>. Then, go to the <em>Git</em> tab, check all files and folders, click <em>commit</em>, add a <em>commit message</em> (eg “my first version of my first R package”) and <em>commit</em>.</p>
</div>
<div id="create-new-empty-github-repository" class="section level4">
<h4>Create new, empty GitHub repository</h4>
<p>We will now make our package publically available on GitHub. If we want others to see and use our work we have to make this repository public.</p>
<ol style="list-style-type: decimal">
<li>Go to <code>github.com</code> and click on your username (should be on the top right).</li>
<li>Choose <em>Repositories -&gt; New</em></li>
<li>The repository name is <em>gameday</em>. You can leave <em>Description</em> empty. Choose <strong>Public</strong> and <strong>do NOT initialize with a README</strong>.</li>
<li>Copy the address of the repository. For me this is <code>https://github.com/BernhardKonrad/gameday</code>.</li>
</ol>
</div>
<div id="connect-rstudio-and-github" class="section level4">
<h4>Connect RStudio and GitHub</h4>
<p>We have to tell <em>RStudio</em> where to put the files of our new package. For this, we have to briefly default back to the <em>Shell</em>:</p>
<ol style="list-style-type: decimal">
<li><em>Tools -&gt; Shell…</em>.</li>
<li>In the shell we have to add the GitHub repository as a remote, and we abbreviate it as <em>origin</em>: <code>git remote add origin https://github.com/BernhardKonrad/gameday</code>.</li>
<li>Push your changes to the new remote (branch <em>master</em>), and set this remote as the new default: <code>git push -u origin master</code>.</li>
<li>Close the shell, you will now be able to push and pull directly from <em>RStudio</em>.</li>
<li>Your package is now publically (and freely, remember the License) available to the world.</li>
<li><p>It gets better: You can actually install your package from GitHub directly:</p>
<pre><code>install_github(&quot;BernhardKonrad/gameday&quot;)</code></pre></li>
</ol>
</div>
</div>
<div id="tests" class="section level3">
<h3>Tests</h3>
<p>We all feel that we should be testing our code. In fact, we all do, but not in an effective and efficient way.</p>
<blockquote>
<p>It’s not that we don’t test our code, it’s that we don’t store our tests so they can be re-run automatically. (Hadley Wickham)</p>
</blockquote>
<p>Usually we inspect our code interactively and smell test our data. Formal testing, however, is regarded as very advanced and <em>“not worth it”</em> for the daily work. Turns out, a simple test suit like <a href="http://vita.had.co.nz/papers/testthat.html"><code>testthat</code></a> doesn’t only make testing very easy, but will also make you spend less time fixing bugs and more time writing code.</p>
<p>We will use <code>testthat</code> to add tests to our package. The syntax is about as close to english as it gets:</p>
<pre><code># save as test_me.R
test_that(&quot;case is ignored&quot;, {
expect_equal(gday(&quot;canucks&quot;), gday(&quot;Canucks&quot;))
})</code></pre>
<ul>
<li>The first argument is a string that explains what we are testing for. It completes the sentence <em>“Test that…”</em></li>
<li>The second argument is (list of) test(s), that is, checks that have to be satisfied. Above we use <code>expect_equal</code>, but there are many more:
<ul>
<li><code>expect_true(x)</code></li>
<li><code>expect_false(x)</code></li>
<li><code>expect_is(x, y)</code></li>
<li><code>expect_equal(x, y)</code></li>
<li><code>expect_equivalent(x, y)</code></li>
<li><code>expect_identical(x, y)</code></li>
<li><code>expect_matches(x, y)</code></li>
<li><code>expect_output(x, y)</code></li>
<li><code>expect_message(x, y)</code></li>
<li><code>expect_warning(x, y)</code></li>
<li><code>expect_error(x, y)</code></li>
</ul></li>
<li>To run the test you can
<ul>
<li><code>source</code> the corresponding <em>R</em> file,</li>
<li>run <code>test_file(&quot;testMe.R&quot;)</code></li>
<li>run <code>test_dir(&quot;.&quot;)</code></li>
<li>run <code>auto_test(&quot;.&quot;, &quot;./R&quot;)</code></li>
<li>run <code>devtools:check()</code></li>
</ul></li>
</ul>
<p>When you add tests to your package it makes sense to think about a folder structure for where to put the tests. Luckily, <code>devtools</code> also has a function for that:</p>
<ul>
<li><code>devtools::use_testthat()</code></li>
</ul>
<p>This sets up a handy test structure TODO</p>
<pre><code>test_that(&quot;Vancouver Canucks had a game against Nashville Predators on 2014-11-02&quot;, {
expect_true(gday(team.name=&quot;canucks&quot;, date=&quot;2014-11-02&quot;))
expect_true(gday(team.name=&quot;predators&quot;, date=&quot;2014-11-02&quot;))
})

test_that(&quot;Washington Capitals did not play on 2014-11-10&quot;, {
expect_false(gday(team.name=&quot;capitals&quot;, date=&quot;2014-11-10&quot;))
expect_false(gday(team.name=&quot;washington&quot;, date=&quot;2014-11-10&quot;))
})

test_that(&quot;Case is ignored&quot;, {
expect_equal(gday(&quot;canucks&quot;), gday(&quot;Canucks&quot;))
})

test_that(&quot;Wrong date type throws error&quot;, {
expect_error(gday(&quot;Bruins&quot;, date=&quot;201-111-10&quot;), &quot;Error&quot;)
})</code></pre>
</div>
<div id="update-the-r-code" class="section level3">
<h3>Update the R code</h3>
<pre><code>#&#39; Is it Gameday?
#&#39;
#&#39; This function returns TRUE if your NHL team plays today
#&#39; and FALSE otherwise
#&#39;
#&#39; You know then problem: You&#39;re in your office writing R code and
#&#39; suddenly have the urge to check whether your NHL team has a game today.
#&#39; Before you know it you just wasted 15 minutes browsing the lastest
#&#39; news on your favorite hockey webpage.
#&#39; Suffer no more! You can now ask R directly, without tempting yourself
#&#39; by firing up your web browser.
#&#39;
#&#39; @param team.name The name of your team
#&#39; @param date The date you want to check. Defaults to today (\code{Sys.Date()})
#&#39; @return Logical \code{TRUE} if \code{team.name} has a NHL game today,
#&#39; \code{FALSE} otherwise
#&#39; @note case in \code{team.name} is ignored
#&#39; @export
#&#39; @examples
#&#39; gday(&quot;canucks&quot;)
#&#39; gday(&quot;Bruins&quot;)
#&#39; gday(&quot;ottawa&quot;, date=&quot;2014-11-09&quot;)
gday &lt;- function(team.name, date=Sys.Date()){
  stopifnot(!is.nan(as.Date(date)))
  url  &lt;- paste0(&#39;http://live.nhle.com/GameData/GCScoreboard/&#39;,
                date, &#39;.jsonp&#39;)
  grepl(team.name, getURL(url), ignore.case=TRUE)
}</code></pre>
</div>
<div id="let-devtools-roxygen2-compile-the-documenation-for-you" class="section level3">
<h3>Let devtools, roxygen2 compile the documenation for you</h3>
<pre><code>library(&quot;devtools&quot;)
document()</code></pre>
<p>Observe the new file <code>man/gameday.Rd</code>.</p>
<hr />
</div>
</div>

<div class="footer">
This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/3.0/">CC BY-NC 3.0 Creative Commons License</a>.
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
